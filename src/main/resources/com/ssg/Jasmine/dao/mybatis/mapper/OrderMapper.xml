<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssg.Jasmine.dao.mybatis.mapper.OrderMapper">
  <cache />
  <sql id="BaseColumns">
  	orderId,
  	cardBank, cardNo, validDate, cvc,
  	address, 
  	phone,
  	refundBank, refundAccount,
  	totalPrice, 
  	orderDate, 
  	userId,
  	auctionId
  </sql>
  
  <select id="getOrder" parameterType="int" resultType="Order">
  	SELECT <include refid="BaseColumns" />
  	FROM Order_
  	WHERE orderId = #{orderId}
  </select>
  
  <resultMap id="resultMap" type="Order">
		<id column="orderId" property="orderId" />
		<result column="cardBank" property="cardBank" />
		<result column="cardNo" property="cardNo" />
		<result column="validDate" property="validDate" />
		<result column="cvc" property="cvc" />
		<result column="address" property="address" />
		<result column="phone" property="phone" />
		<result column="refundBank" property="refundBank" />
		<result column="refundAccount" property="refundAccount" />
		<result column="totalPrice" property="totalPrice" />
		<result column="orderDate" property="orderDate" />
		<result column="userId" property="userId" />
		<result column="auctionId" property="auctionId" />
		
  		<!-- <collection property="lineGroupBuys" ofType="LineGroupBuy">
  			<id property="lineId" column="lineId" />
  			<result property="orderId" column="line_orderId" />
  			<result property="groupBuyId" column="groupBuyId" />
  			<result property="quantity" column="quantity" />
  			<result property="selectOption" column="selectOption" />
  			<result property="unitPrice" column="unitPrice" />
  		</collection> -->
  </resultMap> 
  
 <!--  <select id="getOrderWithLineGroupBuys" parameterType="int" resultMap="resultMap">
  	SELECT o.orderId, o.cardBank, o.cardNo, o.validDate, o.cvc,
  		   o.address, o.phone,
  		   o.refundBank, o.refundAccount, o.totalPrice, o.orderDate, o.userId,
  		   l.lineId, l.orderId AS line_orderId, l.groupBuyId, l.quantity, l.selectOption, l.unitPrice
  	FROM orders o, lineGroupBuys l
  	WHERE o.orderId = l.orderId AND o.orderId = #{orderId}
  </select> -->

  <insert id="createOrder" parameterType="Order">
		<!-- <selectKey keyProperty="orderId" resultType="int" order="BEFORE">
			SELECT SEQ_ORDERID.nextval AS orderId FROM Order_
		</selectKey> -->
   
  	INSERT INTO Order_ (<include refid="BaseColumns" />)
  	VALUES (seq_orderId.nextval, #{cardBank}, #{cardNo}, #{validDate}, #{cvc},
  		#{address},  #{phone}, #{refundBank}, #{refundAccount}, #{totalPrice}, 
  		SYSDATE, #{userId}, #{auction.auctionId})
  </insert>
  
<!--   <select id="getGroupBuyId" parameterType="int" resultType="int">
  	SELECT DISTINCT groupBuyId
	FROM lineGroupBuys
	WHERE orderId = #{orderId}
  </select> -->
  
  <select id="getAuctionId" parameterType="int" resultType="int">
  	SELECT auctionId
	FROM successBidders
	WHERE orderId = #{orderId}
  </select>
  
  <delete id="deleteOrderByUserId" parameterType="Integer">
  	DELETE FROM ORDERS
  	WHERE USERID = #{userId}
  </delete>
 
 </mapper>